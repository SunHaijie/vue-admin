{"remainingRequest":"/Users/Jeff/Documents/workspace-vs/vue-admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/Jeff/Documents/workspace-vs/vue-admin/src/views/User/dialog/add.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/Jeff/Documents/workspace-vs/vue-admin/src/views/User/dialog/add.vue","mtime":1614524980232},{"path":"/Users/Jeff/Documents/workspace-vs/vue-admin/node_modules/cache-loader/dist/cjs.js","mtime":1613959811244},{"path":"/Users/Jeff/Documents/workspace-vs/vue-admin/node_modules/babel-loader/lib/index.js","mtime":1613959810487},{"path":"/Users/Jeff/Documents/workspace-vs/vue-admin/node_modules/cache-loader/dist/cjs.js","mtime":1613959811244},{"path":"/Users/Jeff/Documents/workspace-vs/vue-admin/node_modules/vue-loader/lib/index.js","mtime":1613959818680}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBzaGExIGZyb20gJ2pzLXNoYTEnOwppbXBvcnQgeyBHZXRSb2xlLCBVc2VyQWRkIH0gZnJvbSAiQC9hcGkvdXNlciI7CmltcG9ydCB7IHJlYWN0aXZlLCByZWYsIHdhdGNoLCBvbkJlZm9yZU1vdW50IH0gZnJvbSAnQHZ1ZS9jb21wb3NpdGlvbi1hcGknOwovLyDov4fmu6QKaW1wb3J0IHsgc3RyaXBzY3JpcHQsIHZhbGlkYXRlUGFzcywgdmFsaWRhdGVFbWFpbCB9IGZyb20gJ0AvdXRpbHMvdmFsaWRhdGUnOwovLyDnu4Tku7YKaW1wb3J0IENpdHlQaWNrZXIgZnJvbSAiQGMvQ2l0eVBpY2tlciIKZXhwb3J0IGRlZmF1bHQgewogICAgbmFtZTogJ2RpYWxvZ0luZm8nLAogICAgY29tcG9uZW50czogeyBDaXR5UGlja2VyIH0sCiAgICBwcm9wczogewogICAgICAgIGZsYWc6IHsKICAgICAgICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgICAgICAgZGVmYXVsdDogZmFsc2UKICAgICAgICB9LAogICAgICAgIGVkaXREYXRhOiB7CiAgICAgICAgICAgIHR5cGU6IE9iamVjdCwKICAgICAgICAgICAgZGVmYXVsdDogKCkgPT4ge30KICAgICAgICB9CiAgICB9LAogICAKICAgIHNldHVwKHByb3BzLCB7IGVtaXQsIHJvb3QsIHJlZnMgfSl7CiAgICAgICAgLy8g6aqM6K+B55So5oi35ZCNCiAgICAgICAgbGV0IHZhbGlkYXRlVXNlcm5hbWUgPSAocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSA9PiB7CiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJycpIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcign6K+36L6T5YWl55So5oi35ZCNJykpOwogICAgICAgICAgICB9IGVsc2UgaWYodmFsaWRhdGVFbWFpbCh2YWx1ZSkpewogICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKCfnlKjmiLflkI3moLzlvI/mnInor68nKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjaygpOyAvL3RydWUKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgLy8g6aqM6K+B5a+G56CBCiAgICAgICAgbGV0IHZhbGlkYXRlUGFzc3dvcmQgPSAocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSA9PiB7CiAgICAgICAgICAgIC8vIOi/h+a7pOWQjueahOaVsOaNrgogICAgICAgICAgICBpZih2YWx1ZSkgewogICAgICAgICAgICAgICAgZGF0YS5mb3JtLnBhc3N3b3JkID0gc3RyaXBzY3JpcHQodmFsdWUpOwogICAgICAgICAgICAgICAgdmFsdWUgPSBkYXRhLmZvcm0ucGFzc3dvcmQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHZhbHVlID09PSAnJykgewogICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKCLor7fovpPlhaXlr4bnoIEiKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsaWRhdGVQYXNzKHZhbHVlKSkgewogICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKCLlr4bnoIHkuLo26IezMjDkvY3mlbDlrZcr5a2X5q+NIikpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgLyoqCiAgICAgICAgICog5pWw5o2uCiAgICAgICAgICovCiAgICAgICAgY29uc3QgZGF0YSA9IHJlYWN0aXZlKHsKICAgICAgICAgICAgZGlhbG9nX2luZm9fZmxhZzogZmFsc2UsICAvLyDlvLnnqpfmoIforrAKICAgICAgICAgICAgY2l0eVBpY2tlckRhdGE6IHt9LAogICAgICAgICAgICBmb3JtTGFiZWxXaWR0aDogJzkwcHgnLAogICAgICAgICAgICBmb3JtOiB7CiAgICAgICAgICAgICAgICB1c2VybmFtZTogIiIsCiAgICAgICAgICAgICAgICB0cnVlbmFtZTogIiIsCiAgICAgICAgICAgICAgICBwYXNzd29yZDogIiIsCiAgICAgICAgICAgICAgICBwaG9uZTogIiIsCiAgICAgICAgICAgICAgICByZWdpb246ICIiLAogICAgICAgICAgICAgICAgc3RhdHVzOiAiMiIsCiAgICAgICAgICAgICAgICByb2xlOiBbXQogICAgICAgICAgICB9LAogICAgICAgICAgICBydWxlczogcmVhY3RpdmUoewogICAgICAgICAgICAgICAgdXNlcm5hbWU6IFsKICAgICAgICAgICAgICAgICAgICB7IHZhbGlkYXRvcjogdmFsaWRhdGVVc2VybmFtZSwgdHJpZ2dlcjogJ2JsdXInIH0KICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICBwYXNzd29yZDogWwogICAgICAgICAgICAgICAgICAgIHsgdmFsaWRhdG9yOiB2YWxpZGF0ZVBhc3N3b3JkLCB0cmlnZ2VyOiAnYmx1cicgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIHJvbGU6IFsKICAgICAgICAgICAgICAgICAgICB7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAi6K+36YCJ5oup6KeS6ImyIiwgdHJpZ2dlcjogJ2NoYW5nZScgfQogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgLy8g6KeS6Imy6YCJ5oupCiAgICAgICAgICAgIHJvbGVJdGVtOiBbXSwKICAgICAgICAgICAgLy8g5oyJ6ZKu5Yqg6L29CiAgICAgICAgICAgIHN1Ym1pdExvYWRpbmc6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgLy8gd2F0Y2gKICAgICAgICB3YXRjaCgoKSA9PiBkYXRhLmRpYWxvZ19pbmZvX2ZsYWcgPSBwcm9wcy5mbGFnKTsKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgKiAqKioqKioqKioqCiAgICAgICAgICogKioqKioqKiogKi8KICAgICAgICAvKioKICAgICAgICAgKiDor7fmsYLop5LoibIKICAgICAgICAgKi8KICAgICAgICBjb25zdCBnZXRSb2xlID0gKCkgPT4gewogICAgICAgICAgICBHZXRSb2xlKCkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgICBkYXRhLnJvbGVJdGVtID0gcmVzcG9uc2UuZGF0YS5kYXRhCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIOW8ueeql+aJk+W8gO+8jOWKqOeUu+e7k+adn+aXtgogICAgICAgICAqLwogICAgICAgIGNvbnN0IG9wZW5EaWFsb2cgPSAoKSA9PiB7CiAgICAgICAgICAgIC8vIOinkuiJsuivt+axggogICAgICAgICAgICBnZXRSb2xlKCkKICAgICAgICAgICAgLy8g5Yid5aeL5YC85aSE55CGCiAgICAgICAgICAgIGxldCBlZGl0RGF0YSA9IHByb3BzLmVkaXREYXRhOwogICAgICAgICAgICBlZGl0RGF0YS5yb2xlID0gZWRpdERhdGEucm9sZS5zcGxpdCgnLCcpOwogICAgICAgICAgICBkYXRhLmZvcm0gPSBlZGl0RGF0YQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiB2dWUyLjAgbWV0aG9kcwogICAgICAgICAqLwogICAgICAgIGNvbnN0IGNsb3NlID0gKCkgPT4gewogICAgICAgICAgICBkYXRhLmRpYWxvZ19pbmZvX2ZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgcmVzZXRGb3JtKCkKICAgICAgICAgICAgZW1pdCgidXBkYXRlOmZsYWciLCBmYWxzZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0IHJlc2V0Rm9ybSA9ICgpID0+IHsKICAgICAgICAgICAgZGF0YS5jaXR5UGlja2VyRGF0YSA9IHt9CiAgICAgICAgICAgIHJlZnMuYWRkSW5mb0Zvcm0ucmVzZXRGaWVsZHMoKTsKICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgY29uc3Qgc3VibWl0ID0gKGZvcm1OYW1lKSA9PiB7CiAgICAgICAgICAgIHJlZnNbZm9ybU5hbWVdLnZhbGlkYXRlKCh2YWxpZCkgPT4gewogICAgICAgICAgICAgICAgLy8g6KGo5Y2V6aqM6K+B6YCa6L+HCiAgICAgICAgICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyDmlbDmja7lpITnkIYKICAgICAgICAgICAgICAgICAgICBsZXQgcmVxdWVzdERhdGEgPSBPYmplY3QuYXNzaWduKHt9LCBkYXRhLmZvcm0pOyAvLwogICAgICAgICAgICAgICAgICAgIHJlcXVlc3REYXRhLnJvbGUgPSByZXF1ZXN0RGF0YS5yb2xlLmpvaW4oKTsgIC8vIOaVsOe7hOi9rOWtl+espuS4su+8jOm7mOiupOS7pe+8jOWPt+malOW8gAogICAgICAgICAgICAgICAgICAgIHJlcXVlc3REYXRhLnJlZ2lvbiA9IEpTT04uc3RyaW5naWZ5KGRhdGEuY2l0eVBpY2tlckRhdGEpOwogICAgICAgICAgICAgICAgICAgIHJlcXVlc3REYXRhLnBhc3N3b3JkID0gc2hhMShyZXF1ZXN0RGF0YS5wYXNzd29yZCk7CiAgICAgICAgICAgICAgICAgICAgVXNlckFkZChyZXF1ZXN0RGF0YSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXRhID0gcmVzcG9uc2UuZGF0YQogICAgICAgICAgICAgICAgICAgICAgICByb290LiRtZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGRhdGEubWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIgogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICBjbG9zZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBlbWl0KCdyZWZyZXNoVGFiZWxEYXRhJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICAvLyBtZXRob2RzCiAgICAgICAgICAgIGNsb3NlLCBvcGVuRGlhbG9nLCBzdWJtaXQKICAgICAgICB9CiAgICB9Cn0K"},{"version":3,"sources":["add.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"add.vue","sourceRoot":"src/views/User/dialog","sourcesContent":["<template>\n    <el-dialog title=\"新增\" :visible.sync=\"data.dialog_info_flag\" @close=\"close\" width=\"700px\" @opened=\"openDialog\">\n        <el-form :model=\"data.form\" :rules=\"data.rules\" ref=\"addInfoForm\">\n            <el-form-item label=\"用户名：\" :label-width=\"data.formLabelWidth\" prop=\"username\">\n                <el-input v-model=\"data.form.username\" placeholder=\"请输入邮箱\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"密码：\" :label-width=\"data.formLabelWidth\" prop=\"password\">\n                <el-input type=\"password\" v-model=\"data.form.password\" placeholder=\"请输入6~20数字+字母\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"姓名：\" :label-width=\"data.formLabelWidth\" prop=\"truename\">\n                <el-input v-model=\"data.form.truename\" placeholder=\"请输入真实姓名\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"手机号：\" :label-width=\"data.formLabelWidth\" prop=\"phone\">\n                <el-input v-model.number=\"data.form.phone\" placeholder=\"请输入手机号\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"地区：\" :label-width=\"data.formLabelWidth\" prop=\"region\">\n                <CityPicker :cityPickerData.sync=\"data.cityPickerData\" />\n            </el-form-item>\n            <el-form-item label=\"是否启用：\" :label-width=\"data.formLabelWidth\" prop=\"status\">\n                <el-radio v-model=\"data.form.status\" label=\"1\">禁用</el-radio>\n                <el-radio v-model=\"data.form.status\" label=\"2\">启用</el-radio>\n            </el-form-item>\n            <el-form-item label=\"角色：\" :label-width=\"data.formLabelWidth\" prop=\"role\">\n                <el-checkbox-group v-model=\"data.form.role\">\n                    <el-checkbox v-for=\"item in data.roleItem\" :key=\"item.role\" :label=\"item.role\">{{ item.name }}</el-checkbox>\n                </el-checkbox-group>\n            </el-form-item>\n        </el-form>\n        <div slot=\"footer\" class=\"dialog-footer\">\n            <el-button @click=\"close\">取消</el-button>\n            <el-button type=\"danger\" :loading=\"data.submitLoading\" @click=\"submit('addInfoForm')\">确定</el-button>\n        </div>\n    </el-dialog>\n</template>\n<script>\nimport sha1 from 'js-sha1';\nimport { GetRole, UserAdd } from \"@/api/user\";\nimport { reactive, ref, watch, onBeforeMount } from '@vue/composition-api';\n// 过滤\nimport { stripscript, validatePass, validateEmail } from '@/utils/validate';\n// 组件\nimport CityPicker from \"@c/CityPicker\"\nexport default {\n    name: 'dialogInfo',\n    components: { CityPicker },\n    props: {\n        flag: {\n            type: Boolean,\n            default: false\n        },\n        editData: {\n            type: Object,\n            default: () => {}\n        }\n    },\n   \n    setup(props, { emit, root, refs }){\n        // 验证用户名\n        let validateUsername = (rule, value, callback) => {\n            if (value === '') {\n                callback(new Error('请输入用户名'));\n            } else if(validateEmail(value)){\n                callback(new Error('用户名格式有误'));\n            } else {\n                callback(); //true\n            }\n        };\n        // 验证密码\n        let validatePassword = (rule, value, callback) => {\n            // 过滤后的数据\n            if(value) {\n                data.form.password = stripscript(value);\n                value = data.form.password;\n            }\n            if (value === '') {\n                callback(new Error(\"请输入密码\"));\n            } else if (validatePass(value)) {\n                callback(new Error(\"密码为6至20位数字+字母\"));\n            } else {\n                callback();\n            }\n        };\n        /**\n         * 数据\n         */\n        const data = reactive({\n            dialog_info_flag: false,  // 弹窗标记\n            cityPickerData: {},\n            formLabelWidth: '90px',\n            form: {\n                username: \"\",\n                truename: \"\",\n                password: \"\",\n                phone: \"\",\n                region: \"\",\n                status: \"2\",\n                role: []\n            },\n            rules: reactive({\n                username: [\n                    { validator: validateUsername, trigger: 'blur' }\n                ],\n                password: [\n                    { validator: validatePassword, trigger: 'blur' }\n                ],\n                role: [\n                    { required: true, message: \"请选择角色\", trigger: 'change' }\n                ]\n            }),\n            // 角色选择\n            roleItem: [],\n            // 按钮加载\n            submitLoading: false\n        });\n        // watch\n        watch(() => data.dialog_info_flag = props.flag);\n\n        /*****************************************\n         * ********************\n         * **********\n         * ******** */\n        /**\n         * 请求角色\n         */\n        const getRole = () => {\n            GetRole().then(response => {\n                data.roleItem = response.data.data\n            })\n        }\n        /**\n         * 弹窗打开，动画结束时\n         */\n        const openDialog = () => {\n            // 角色请求\n            getRole()\n            // 初始值处理\n            let editData = props.editData;\n            editData.role = editData.role.split(',');\n            data.form = editData\n        }\n        \n        /**\n         * vue2.0 methods\n         */\n        const close = () => {\n            data.dialog_info_flag = false;\n            resetForm()\n            emit(\"update:flag\", false);\n        }\n        \n        const resetForm = () => {\n            data.cityPickerData = {}\n            refs.addInfoForm.resetFields();\n           \n        }\n        const submit = (formName) => {\n            refs[formName].validate((valid) => {\n                // 表单验证通过\n                if (valid) {\n                    // 数据处理\n                    let requestData = Object.assign({}, data.form); //\n                    requestData.role = requestData.role.join();  // 数组转字符串，默认以，号隔开\n                    requestData.region = JSON.stringify(data.cityPickerData);\n                    requestData.password = sha1(requestData.password);\n                    UserAdd(requestData).then(response => {\n                        let data = response.data\n                        root.$message({\n                            message: data.message,\n                            type: \"success\"\n                        })\n                        close();\n                        emit('refreshTabelData');\n                    })\n                } else {\n                    return false;\n                }\n            })\n        }\n        return {\n            data,\n            // methods\n            close, openDialog, submit\n        }\n    }\n}\n</script>\n<style scoped>\n\n</style>"]}]}