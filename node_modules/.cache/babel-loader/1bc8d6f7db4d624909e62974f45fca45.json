{"remainingRequest":"/Users/Jeff/Documents/workspace-vs/vue-admin/node_modules/babel-loader/lib/index.js!/Users/Jeff/Documents/workspace-vs/vue-admin/src/router/premit.js","dependencies":[{"path":"/Users/Jeff/Documents/workspace-vs/vue-admin/src/router/premit.js","mtime":1614523093495},{"path":"/Users/Jeff/Documents/workspace-vs/vue-admin/node_modules/cache-loader/dist/cjs.js","mtime":1613959811244},{"path":"/Users/Jeff/Documents/workspace-vs/vue-admin/node_modules/babel-loader/lib/index.js","mtime":1613959810487}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YuanMiOwppbXBvcnQgX29iamVjdFNwcmVhZCBmcm9tICIvVXNlcnMvSmVmZi9Eb2N1bWVudHMvd29ya3NwYWNlLXZzL3Z1ZS1hZG1pbi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCByb3V0ZXIgZnJvbSAiLi9pbmRleCI7CmltcG9ydCBzdG9yZSBmcm9tICIuLi9zdG9yZS9pbmRleCI7CmltcG9ydCB7IGdldFRvS2VuLCByZW1vdmVUb0tlbiwgcmVtb3ZlVXNlck5hbWUgfSBmcm9tICJAL3V0aWxzL2FwcCI7CnZhciB3aGl0ZVJvdXRlciA9IFsnL2xvZ2luJ107IC8vIGluZGV4T2bmlrnms5XvvIzliKTmlq3mlbDnu4TkuK3mmK/lkKblrZjlnKjmjIflrprnmoTmn5DkuKrlr7nosaHvvIzlpoLmnpzkuI3lrZjlnKjvvIzliJnov5Tlm54tMQovLyDot6/nlLHlrojljasKCnJvdXRlci5iZWZvcmVFYWNoKGZ1bmN0aW9uICh0bywgZnJvbSwgbmV4dCkgewogIGlmIChnZXRUb0tlbigpKSB7CiAgICBpZiAodG8ucGF0aCA9PT0gJy9sb2dpbicpIHsKICAgICAgcmVtb3ZlVG9LZW4oKTsKICAgICAgcmVtb3ZlVXNlck5hbWUoKTsKICAgICAgc3RvcmUuY29tbWl0KCJhcHAvU0VUX1RPS0VOIiwgJycpOwogICAgICBzdG9yZS5jb21taXQoImFwcC9TRVRfVVNFUk5BTUUiLCAnJyk7CiAgICAgIG5leHQoKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIOiOt+WPlueUqOaIt+eahOiJsgogICAgICAvLyDliqjmgIHliIbphY3ot6/nlLHmnYPpmZAKCiAgICAgIC8qKgogICAgICAgKiAx44CB5LuA5LmI5pe25YCZ5aSE55CG5Yqo5oCB6Lev55SxCiAgICAgICAqIDLjgIHku6Xku4DkuYjmnaHku7blpITnkIYKICAgICAgICogcm9sZXNbXQogICAgICAgKi8KICAgICAgaWYgKHN0b3JlLmdldHRlcnNbJ2FwcC9yb2xlcyddLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHN0b3JlLmRpc3BhdGNoKCdwZXJtaXNzaW9uL2dldFJvbGVzJykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIHZhciByb2xlID0gcmVzcG9uc2Uucm9sZTsKICAgICAgICAgIHZhciBidXR0b24gPSByZXNwb25zZS5idXR0b247IC8vIOi/meaYr+S4iuWtpuaXtuivtOeahOWGheWuuQoKICAgICAgICAgIHZhciBidG5QZXJtID0gcmVzcG9uc2UuYnRuUGVybTsKICAgICAgICAgIHN0b3JlLmNvbW1pdCgiYXBwL1NFVF9ST0xFUyIsIHJvbGUpOwogICAgICAgICAgc3RvcmUuY29tbWl0KCJhcHAvU0VUX0JVVFRPTiIsIGJ0blBlcm0pOyAvLyDlrZjlgqjop5LoibIgCgogICAgICAgICAgc3RvcmUuZGlzcGF0Y2goJ3Blcm1pc3Npb24vY3JlYXRlUm91dGVyJywgcm9sZSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgdmFyIGFkZFJvdXRlcnMgPSBzdG9yZS5nZXR0ZXJzWydwZXJtaXNzaW9uL2FkZFJvdXRlcnMnXTsKICAgICAgICAgICAgdmFyIGFsbFJvdXRlcnMgPSBzdG9yZS5nZXR0ZXJzWydwZXJtaXNzaW9uL2FsbFJvdXRlcnMnXTsgLy8g6Lev55Sx5pu05pawCgogICAgICAgICAgICByb3V0ZXIub3B0aW9ucy5yb3V0ZXMgPSBhbGxSb3V0ZXJzOyAvLyDmt7vliqDliqjmgIHot6/nlLEKCiAgICAgICAgICAgIHJvdXRlci5hZGRSb3V0ZXMoYWRkUm91dGVycyk7CiAgICAgICAgICAgIG5leHQoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCB0byksIHt9LCB7CiAgICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZQogICAgICAgICAgICB9KSk7IC8vIGVzNuaJqeWxlei/kOeul+espu+8jOmYsuatouWGheWuueWPkeeUn+WPmOWMlueahOaDheWGtQogICAgICAgICAgICAvLyDkuI3ooqvorrDlvZXljoblj7LorrDlvZUKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIG5leHQoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiAx44CBdG8gPSAvY29uc29sZQogICAgICogMuOAgXRvID0gL2luZGV4CiAgICAgKi8KICAgIC8vIOi3r+eUseWKqOaAgea3u+WKoO+8jOWIhumFjeiPnOWNle+8jOavj+S4quinkuiJsuWIhumFjeS4jeWQjOeahOiPnOWNlQoKICB9IGVsc2UgewogICAgaWYgKHdoaXRlUm91dGVyLmluZGV4T2YodG8ucGF0aCkgIT09IC0xKSB7CiAgICAgIC8vIOWtmOWcqAogICAgICBuZXh0KCk7IC8vIHRvCiAgICB9IGVsc2UgewogICAgICBuZXh0KCcvbG9naW4nKTsgLy8g6Lev55Sx5oyH5ZCRCiAgICB9CiAgICAvKioKICAgICAqIDHjgIHnm7TmjqXov5vlhaVpbmRleOeahOaXtuWAme+8jOWPguaVsHRv6KKr5pS55Y+Y5oiQ5LqGICIvaW5kZXgi77yM6Kem5Y+R6Lev55Sx5oyH5ZCR77yM5bCx5Lya6LeRYmVmb3JlRWFjaAogICAgICogMuOAgeWGjeS4gOasoSBuZXh0IOaMh+WQkeS6hmxvZ2lu77yM5YaN5qyh5Y+R55Sf6Lev55Sx5oyH5ZCR77yM5YaN6LeRYmVmb3JlRWFjaO+8jOWPguaVsOeahHRv6KKr5pS55Y+Y5oiQ5LqGIi9sb2dpbiIKICAgICAqIDPjgIHnmb3lkI3ljZXliKTmlq3lrZjlnKjvvIzliJnnm7TmjqXmiafooYxuZXh0KCnvvIzlm6DkuLrmsqHmnInlj4LmlbDvvIzmiYDku6XkuI3kvJrlho3mrKFiZWZvcmVFYWNo44CCCiAgICAgKi8KCiAgfQp9KTs="},{"version":3,"sources":["/Users/Jeff/Documents/workspace-vs/vue-admin/src/router/premit.js"],"names":["router","store","getToKen","removeToKen","removeUserName","whiteRouter","beforeEach","to","from","next","path","commit","getters","length","dispatch","then","response","role","button","btnPerm","addRouters","allRouters","options","routes","addRoutes","replace","indexOf"],"mappings":";;AAAA,OAAOA,MAAP,MAAmB,SAAnB;AACA,OAAOC,KAAP,MAAkB,gBAAlB;AAEA,SAASC,QAAT,EAAmBC,WAAnB,EAAgCC,cAAhC,QAAsD,aAAtD;AAEA,IAAMC,WAAW,GAAG,CAAC,QAAD,CAApB,C,CAAgC;AAEhC;;AACAL,MAAM,CAACM,UAAP,CAAkB,UAACC,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAoB;AAClC,MAAIP,QAAQ,EAAZ,EAAgB;AACZ,QAAIK,EAAE,CAACG,IAAH,KAAY,QAAhB,EAA0B;AACtBP,MAAAA,WAAW;AACXC,MAAAA,cAAc;AACdH,MAAAA,KAAK,CAACU,MAAN,CAAa,eAAb,EAA8B,EAA9B;AACAV,MAAAA,KAAK,CAACU,MAAN,CAAa,kBAAb,EAAiC,EAAjC;AACAF,MAAAA,IAAI;AACP,KAND,MAMO;AACH;AACA;;AACA;AACZ;AACA;AACA;AACA;AACY,UAAIR,KAAK,CAACW,OAAN,CAAc,WAAd,EAA2BC,MAA3B,KAAsC,CAA1C,EAA6C;AACzCZ,QAAAA,KAAK,CAACa,QAAN,CAAe,qBAAf,EAAsCC,IAAtC,CAA2C,UAAAC,QAAQ,EAAI;AACnD,cAAIC,IAAI,GAAGD,QAAQ,CAACC,IAApB;AACA,cAAIC,MAAM,GAAGF,QAAQ,CAACE,MAAtB,CAFmD,CAErB;;AAC9B,cAAIC,OAAO,GAAGH,QAAQ,CAACG,OAAvB;AACAlB,UAAAA,KAAK,CAACU,MAAN,CAAa,eAAb,EAA8BM,IAA9B;AACAhB,UAAAA,KAAK,CAACU,MAAN,CAAa,gBAAb,EAA+BQ,OAA/B,EALmD,CAMnD;;AACAlB,UAAAA,KAAK,CAACa,QAAN,CAAe,yBAAf,EAA0CG,IAA1C,EAAgDF,IAAhD,CAAqD,UAAAC,QAAQ,EAAI;AAC7D,gBAAII,UAAU,GAAGnB,KAAK,CAACW,OAAN,CAAc,uBAAd,CAAjB;AACA,gBAAIS,UAAU,GAAGpB,KAAK,CAACW,OAAN,CAAc,uBAAd,CAAjB,CAF6D,CAG7D;;AACAZ,YAAAA,MAAM,CAACsB,OAAP,CAAeC,MAAf,GAAwBF,UAAxB,CAJ6D,CAK7D;;AACArB,YAAAA,MAAM,CAACwB,SAAP,CAAiBJ,UAAjB;AACAX,YAAAA,IAAI,iCAAMF,EAAN;AAAUkB,cAAAA,OAAO,EAAE;AAAnB,eAAJ,CAP6D,CAQ7D;AACA;AACH,WAVD;AAWH,SAlBD;AAmBH,OApBD,MAoBO;AACHhB,QAAAA,IAAI;AACP;AACJ;AACD;AACR;AACA;AACA;AACQ;;AACH,GA5CD,MA4CO;AACH,QAAIJ,WAAW,CAACqB,OAAZ,CAAoBnB,EAAE,CAACG,IAAvB,MAAiC,CAAC,CAAtC,EAAyC;AAAG;AACxCD,MAAAA,IAAI,GADiC,CAC5B;AACZ,KAFD,MAEO;AACHA,MAAAA,IAAI,CAAC,QAAD,CAAJ,CADG,CACa;AACnB;AACD;AACR;AACA;AACA;AACA;;AACK;AACJ,CAzDD","sourcesContent":["import router from \"./index\";\nimport store from \"../store/index\";\n\nimport { getToKen, removeToKen, removeUserName } from \"@/utils/app\";\n\nconst whiteRouter = ['/login']; // indexOf方法，判断数组中是否存在指定的某个对象，如果不存在，则返回-1\n\n// 路由守卫\nrouter.beforeEach((to, from, next) => {\n    if (getToKen()) {\n        if (to.path === '/login') {\n            removeToKen();\n            removeUserName();\n            store.commit(\"app/SET_TOKEN\", '');\n            store.commit(\"app/SET_USERNAME\", '');\n            next();\n        } else {\n            // 获取用户的色\n            // 动态分配路由权限\n            /**\n             * 1、什么时候处理动态路由\n             * 2、以什么条件处理\n             * roles[]\n             */\n            if (store.getters['app/roles'].length === 0) {\n                store.dispatch('permission/getRoles').then(response => {\n                    let role = response.role;\n                    let button = response.button; // 这是上学时说的内容\n                    let btnPerm = response.btnPerm;\n                    store.commit(\"app/SET_ROLES\", role);\n                    store.commit(\"app/SET_BUTTON\", btnPerm);\n                    // 存储角色 \n                    store.dispatch('permission/createRouter', role).then(response => {\n                        let addRouters = store.getters['permission/addRouters'];\n                        let allRouters = store.getters['permission/allRouters'];\n                        // 路由更新\n                        router.options.routes = allRouters;\n                        // 添加动态路由\n                        router.addRoutes(addRouters)\n                        next({ ...to, replace: true });\n                        // es6扩展运算符，防止内容发生变化的情况\n                        // 不被记录历史记录\n                    })\n                });\n            } else {\n                next();\n            }\n        }\n        /**\n         * 1、to = /console\n         * 2、to = /index\n         */\n        // 路由动态添加，分配菜单，每个角色分配不同的菜单\n    } else {\n        if (whiteRouter.indexOf(to.path) !== -1) {  // 存在\n            next();  // to\n        } else {\n            next('/login')  // 路由指向\n        }\n        /**\n         * 1、直接进入index的时候，参数to被改变成了 \"/index\"，触发路由指向，就会跑beforeEach\n         * 2、再一次 next 指向了login，再次发生路由指向，再跑beforeEach，参数的to被改变成了\"/login\"\n         * 3、白名单判断存在，则直接执行next()，因为没有参数，所以不会再次beforeEach。\n         */\n    }\n})"]}]}