{"remainingRequest":"/Users/Jeff/Documents/workspace-vs/vue-admin/node_modules/babel-loader/lib/index.js!/Users/Jeff/Documents/workspace-vs/vue-admin/src/store/modules/permission.js","dependencies":[{"path":"/Users/Jeff/Documents/workspace-vs/vue-admin/src/store/modules/permission.js","mtime":1614523252372},{"path":"/Users/Jeff/Documents/workspace-vs/vue-admin/node_modules/cache-loader/dist/cjs.js","mtime":1613959811244},{"path":"/Users/Jeff/Documents/workspace-vs/vue-admin/node_modules/babel-loader/lib/index.js","mtime":1613959810487}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNvbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzLmpzIjsKaW1wb3J0IHsgZ2V0VXNlclJvbGUgfSBmcm9tICJAL2FwaS9sb2dpbiI7CmltcG9ydCB7IGRlZmF1bHRSb3V0ZXJNYXAsIGFzbnljUm91dGVyTWFwIH0gZnJvbSAiQC9yb3V0ZXIiOwoKZnVuY3Rpb24gaGFzUHJlbWlzc2lvbihyb2xlcywgcm91dGVyKSB7CiAgaWYgKHJvdXRlci5tZXRhICYmIHJvdXRlci5tZXRhLnJvbGUpIHsKICAgIHJldHVybiByb2xlcy5zb21lKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgIHJldHVybiByb3V0ZXIubWV0YS5yb2xlLmluZGV4T2YoaXRlbSkgPj0gMDsKICAgIH0pOwogIH0gLy8gLy8gaW5kZXhPZiDlr7nlpKflsI/lhpnmlY/mhJ8KICAvLyBsZXQgc3RyID0gJ2FhYSBBYmMnOwogIC8vIHN0ci5pbmRleE9mKCdhYWEnKSAgLy8gMAogIC8vIHN0ci5pbmRleE9mKCdhYmMnKSAgLy8gLTEKICAvLyBzdHIuaW5kZXhPZignQWJjJykgIC8vIDQKICAvLyBjb25zb2xlLmxvZyhyb2xlcykKICAvLyBjb25zb2xlLmxvZyhyb3V0ZXIubWV0YS5yb2xlKQogIC8vIFsxMSwgMjIsIDMzXS5pbmNsdWRlcygnMTEnKQogIC8vIFsxMSwgMjIsIDMzXS5zb21lKGl0ZW0gPT4gaXRlbSA9IDIyICkKICAvLyDnlKjmiLfop5LoibLvvJpbInNhbGUiLCAidGVjaG5pY2lhbiIsICJtYW5hZ2VyIl0KICAvLyDot6/nlLHphY3nva7vvJpbInNhbGUiXQoKfQoKdmFyIHN0YXRlID0gewogIGFsbFJvdXRlcnM6IGRlZmF1bHRSb3V0ZXJNYXAsCiAgYWRkUm91dGVyczogW10KfTsKdmFyIGdldHRlcnMgPSB7CiAgYWxsUm91dGVyczogZnVuY3Rpb24gYWxsUm91dGVycyhzdGF0ZSkgewogICAgcmV0dXJuIHN0YXRlLmFsbFJvdXRlcnM7CiAgfSwKICAvLyDmiYDmnInnmoQKICBhZGRSb3V0ZXJzOiBmdW5jdGlvbiBhZGRSb3V0ZXJzKHN0YXRlKSB7CiAgICByZXR1cm4gc3RhdGUuYWRkUm91dGVyczsKICB9IC8vIOWMuemFjeeahAoKfTsKdmFyIG11dGF0aW9ucyA9IHsKICAvLyDlv4XpobvnmoQgIOWQjOatpSDmsqHmnInlm57osIPlpITnkIbkuovmg4UKICBTRVRfUk9VVEVSOiBmdW5jdGlvbiBTRVRfUk9VVEVSKHN0YXRlLCByb3V0ZXIpIHsKICAgIHN0YXRlLmFkZFJvdXRlcnMgPSByb3V0ZXI7CiAgICBzdGF0ZS5hbGxSb3V0ZXJzID0gZGVmYXVsdFJvdXRlck1hcC5jb25jYXQocm91dGVyKTsKICB9Cn07CnZhciBhY3Rpb25zID0gewogIC8vIOWPr+S7peWbnuiwg+WkhOeQhuS6i+aDhSAKCiAgLyoqCiAgICog6I635Y+W55So5oi36KeS6ImyIAogICAqIEBwYXJhbSB7Kn0gcGFyYW0wCiAgICogQHBhcmFtIHsqfSByZXB1ZXN0RGF0YSAKICAgKi8KICBnZXRSb2xlczogZnVuY3Rpb24gZ2V0Um9sZXMoX3JlZiwgcmVwdWVzdERhdGEpIHsKICAgIHZhciBjb21taXQgPSBfcmVmLmNvbW1pdDsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIGdldFVzZXJSb2xlKCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICByZXNvbHZlKGRhdGEpOwogICAgICB9KTsKICAgIH0pOwogIH0sCgogIC8qKgogICAqIOWIm+W7uuWKqOaAgei3r+eUsQogICAqLwogIGNyZWF0ZVJvdXRlcjogZnVuY3Rpb24gY3JlYXRlUm91dGVyKF9yZWYyLCBkYXRhKSB7CiAgICB2YXIgY29tbWl0ID0gX3JlZjIuY29tbWl0OwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgLy8gWyJpbmZvU3lzdGVtIiwgInVzZXJTeXN0ZW0iXQogICAgICB2YXIgcm9sZSA9IGRhdGE7IC8vIOi2heeuoeeahOeKtuaAgQoKICAgICAgdmFyIGFkZFJvdXRlcnMgPSBbXTsKCiAgICAgIGlmIChyb2xlLmluY2x1ZGVzKCdhZG1pbicpKSB7CiAgICAgICAgYWRkUm91dGVycyA9IGFzbnljUm91dGVyTWFwOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIOaZrumAmueuoeeQhuWRmCAKICAgICAgICBhZGRSb3V0ZXJzID0gYXNueWNSb3V0ZXJNYXAuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICBpZiAoaGFzUHJlbWlzc2lvbihyb2xlLCBpdGVtKSkgewogICAgICAgICAgICAvLyDkvJjlhYjliKTmlq0gCiAgICAgICAgICAgIGlmIChpdGVtLmNoaWxkcmVuICYmIGl0ZW0uY2hpbGRyZW4ubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGl0ZW0uY2hpbGRyZW4gPSBpdGVtLmNoaWxkcmVuLmZpbHRlcihmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICAgICAgICAgIGlmIChoYXNQcmVtaXNzaW9uKHJvbGUsIGNoaWxkKSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBpdGVtOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGFkZFJvdXRlcnMucHVzaChhc255Y1JvdXRlck1hcFthc255Y1JvdXRlck1hcC5sZW5ndGggLSAxXSk7CiAgICAgIH0gLy8g5pu05paw6Lev55SxCgoKICAgICAgY29tbWl0KCdTRVRfUk9VVEVSJywgYWRkUm91dGVycyk7CiAgICAgIHJlc29sdmUoKTsKICAgIH0pOwogIH0KfTsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWVzcGFjZWQ6IHRydWUsCiAgc3RhdGU6IHN0YXRlLAogIGdldHRlcnM6IGdldHRlcnMsCiAgbXV0YXRpb25zOiBtdXRhdGlvbnMsCiAgYWN0aW9uczogYWN0aW9ucwp9Ow=="},{"version":3,"sources":["/Users/Jeff/Documents/workspace-vs/vue-admin/src/store/modules/permission.js"],"names":["getUserRole","defaultRouterMap","asnycRouterMap","hasPremission","roles","router","meta","role","some","item","indexOf","state","allRouters","addRouters","getters","mutations","SET_ROUTER","concat","actions","getRoles","repuestData","commit","Promise","resolve","reject","then","response","data","createRouter","includes","filter","children","length","child","push","namespaced"],"mappings":"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","sourcesContent":["import { getUserRole } from \"@/api/login\";\nimport { defaultRouterMap, asnycRouterMap } from \"@/router\"\n\nfunction hasPremission(roles, router) {\n    if (router.meta && router.meta.role) {\n        return roles.some(item => router.meta.role.indexOf(item) >= 0)\n    }\n\n    // // indexOf 对大小写敏感\n\n    // let str = 'aaa Abc';\n\n    // str.indexOf('aaa')  // 0\n    // str.indexOf('abc')  // -1\n    // str.indexOf('Abc')  // 4\n\n\n\n    // console.log(roles)\n    // console.log(router.meta.role)\n\n    // [11, 22, 33].includes('11')\n\n    // [11, 22, 33].some(item => item = 22 )\n\n    // 用户角色：[\"sale\", \"technician\", \"manager\"]\n    // 路由配置：[\"sale\"]\n\n\n}\nconst state = {\n    allRouters: defaultRouterMap,\n    addRouters: [],\n\n}\n\nconst getters = {\n    allRouters: state => state.allRouters,  // 所有的\n    addRouters: state => state.addRouters,  // 匹配的\n\n}\n\nconst mutations = {  // 必须的  同步 没有回调处理事情\n    SET_ROUTER(state, router) {\n        state.addRouters = router\n        state.allRouters = defaultRouterMap.concat(router)\n    }\n}\n\nconst actions = {  // 可以回调处理事情 \n    /**\n     * 获取用户角色 \n     * @param {*} param0\n     * @param {*} repuestData \n     */\n    getRoles({ commit }, repuestData) {\n        return new Promise((resolve, reject) => {\n            getUserRole().then(response => {\n                let data = response.data.data;\n                resolve(data);\n            })\n        })\n    },\n    /**\n     * 创建动态路由\n     */\n    createRouter({ commit }, data) {\n        return new Promise((resolve, reject) => {\n            // [\"infoSystem\", \"userSystem\"]\n            let role = data;\n            // 超管的状态\n            let addRouters = []\n            if (role.includes('admin')) {\n                addRouters = asnycRouterMap\n            } else { // 普通管理员 \n                addRouters = asnycRouterMap.filter(item => {\n                    if (hasPremission(role, item)) {\n                        // 优先判断 \n                        if (item.children && item.children.length > 0) {\n                            item.children = item.children.filter(child => {\n                                if (hasPremission(role, child)) {\n                                    return child;\n                                }\n                            })\n                            return item;\n                        }\n                        return item;\n                    }\n                })\n                addRouters.push(asnycRouterMap[asnycRouterMap.length - 1]);\n            }\n            // 更新路由\n            commit('SET_ROUTER', addRouters);\n            resolve()\n        })\n    }\n}\n\n\nexport default {\n    namespaced: true,\n    state,\n    getters,\n    mutations,\n    actions\n};\n"]}]}